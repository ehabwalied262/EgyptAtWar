---
import { getCollection } from 'astro:content';

// جلب كل المسارات الديناميكية
export async function getStaticPaths() {
  const problems = await getCollection('problems');
  const paths = [];

  for (const problem of problems) {
    const articles = await getCollection('articles', (entry) => entry.id.startsWith(`${problem.data.folder}/`));
    articles.forEach((article) => {
      const articleSlug = article.slug.split('/')[1];
      console.log(`Generating path: /problem/${problem.slug}/${articleSlug}`);
      paths.push({
        params: {
          problem: problem.slug,
          slug: articleSlug,
        },
        props: { article },
      });
    });
  }

  return paths;
}

const { article } = Astro.props;
---
<html lang="ar">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <!-- ضروري للـ Responsiveness -->
  </head>

  <body class="bg-gray-900 text-white min-h-screen">
    <section class="py-12">
      <div class="max-w-5xl mx-auto px-4">
        <h1 class="text-4xl font-bold text-center mb-12">{article.data.title}</h1>
        <div class="flex flex-col md:flex-row gap-8">
          <div class="md:w-1/3 flex-shrink-0">
            <img
              src={article.data.image}
              alt={article.data.title}
              class="w-full h-64 md:h-96 object-cover rounded-lg shadow-md"
            />
          </div>
          <div class="md:w-2/3">
            <p class="text-base md:text-lg text-white mb-8">{article.data.description}</p>
            <div class="prose prose-invert max-w-none" set:html={article.body}></div>
          </div>
        </div>
      </div>
    </section>
  </body>
</html>

<style>
  /* تحسين الـ Responsiveness للشاشات الصغيرة */
  @media (max-width: 767px) {
    /* جعل الصورة والمحتوى عموديين */
    .flex-col {
      flex-direction: column;
    }

    /* ضبط ارتفاع الصورة على الموبايل */
    img {
      height: 16rem; /* 256px، مناسب للموبايل */
      max-width: 100%;
    }

    /* تقليل حجم العنوان ليكون مريحًا */
    h1 {
      font-size: 1.75rem; /* 28px */
      margin-bottom: 2rem; /* 32px */
    }

    /* ضبط حجم الوصف والمحتوى */
    p {
      font-size: 0.875rem; /* 14px */
      line-height: 1.5;
    }

    /* تحسين تنسيق النصوص في Prose */
    .prose {
      font-size: 0.875rem; /* 14px */
      line-height: 1.6;
    }

    .prose h2 {
      font-size: 1.25rem; /* 20px */
    }

    .prose h3 {
      font-size: 1rem; /* 16px */
    }

    /* تقليل التباعد العام */
    .gap-8 {
      gap: 1.5rem; /* 24px */
    }

    .py-12 {
      padding-top: 2rem; /* 32px */
      padding-bottom: 2rem;
    }

    .px-4 {
      padding-left: 1rem; /* 16px */
      padding-right: 1rem;
    }
  }

  /* تحسينات للشاشات المتوسطة (تابلت) */
  @media (min-width: 768px) and (max-width: 1023px) {
    h1 {
      font-size: 2.25rem; /* 36px */
    }

    p {
      font-size: 1rem; /* 16px */
    }

    .prose {
      font-size: 1rem; /* 16px */
    }
  }
</style>